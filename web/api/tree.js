export default async function handler(req,res){ try{ const owner=process.env.IK_OWNER, repo=process.env.IK_REPO, branch=process.env.IK_BRANCH||'main'; const token=process.env.IK_GH_TOKEN; if(!owner||!repo||!token) return res.status(400).json({error:'Missing IK_* envs'}); const b=await fetch(`https://api.github.com/repos/${owner}/${repo}/branches/${encodeURIComponent(branch)}`,{headers:{Authorization:`Bearer ${token}`,Accept:'application/vnd.github+json'}}); if(!b.ok) return res.status(b.status).json({error:await b.text()}); const bj=await b.json(); const sha=bj.commit?.commit?.tree?.sha; const t=await fetch(`https://api.github.com/repos/${owner}/${repo}/git/trees/${sha}?recursive=1`,{headers:{Authorization:`Bearer ${token}`,Accept:'application/vnd.github+json'}}); if(!t.ok) return res.status(t.status).json({error:await t.text()}); const tj=await t.json(); res.status(200).json({ok:true,tree:tj.tree}); }catch(e){ res.status(500).json({error:e.message}); } }